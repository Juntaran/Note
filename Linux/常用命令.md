# Linux常用命令

*2017.6.7*

______

## 系统版本信息

命令： uname -a  
作用： 查看系统内核版本号及系统名称，  
`Linux ubuntu 4.10.0-22-generic #24-Ubuntu SMP Mon May 22 17:43:20 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux`   

命令： uname -s
作用： 显示内核名称，`Linux`  

命令： uname -n  
作用： 显示主机名称，`ubuntu`  

命令： uname -r  
作用： 显示内核发行版号，`4.10.0-22-generic`  

命令： uname -v  
作用： 显示操作系统具体版本，`#24-Ubuntu SMP Mon May 22 17:43:20 UTC 2017`  

命令： uname -m  
作用： 显示机器硬件名称，`x86_64`  

命令： uname -p  
作用： 显示处理器类型，`x86_64`  

命令： uname -i  
作用： 显示硬件平台名称，`x86_64`  

命令： uname -o  
作用： 操作系统名称，`GNU/Linux`  

命令： cat /proc/version    
作用： 查看目录"/proc"下version的信息，也可以得到当前系统的内核版本号及系统名称，  
`Linux version 4.10.0-22-generic (buildd@lcy01-08) (gcc version 6.3.0 20170406 (Ubuntu 6.3.0-12ubuntu2) ) #24-Ubuntu SMP Mon May 22 17:43:20 UTC 2017`  

命令： lsb_release -c  
作用： 查看系统代号，比如ubuntu 12.04为precise， 14.04为trusty，15.04为vivid，15.10为wily，17.04为zesty。`Codename:	zesty`  

命令： lsb_release -a  
作用： 显示系统信息以及代号  
`No LSB modules are available.`    
`Distributor ID:	Ubuntu`  
`Description:	Ubuntu 17.04`  
`Release:	17.04`  
`Codename:	zesty`  

命令： lisb_release -d  
作用： 显示系统号，`Description:	Ubuntu 17.04`  

命令： cat /etc/issue  
作用： 显示系统号，`Ubuntu 17.04 \n \l`  

命令： hostname  
作用： 输出计算机名  

______

## 关机

命令： shutdown -h now  
作用： 立即关机  

命令： shutdown -r now  
作用： 立即重启  

命令： shutdown -h 23:30  
作用： 在23:30分准时关机  

命令： shutdown -h +15  
作用： 15分钟后关机  

命令： shutdown -k now “Server would shutdown in 15minutes\!”  
作用： 给出关机警告，不关机  

命令： halt -p  
作用： 关机并关闭电源  

命令： halt -d  
作用： 关机，不会在日志里留下记录  

命令： halt -w  
作用： 不会关机，会把关机事件写入`/var/log/wtmp`  

命令： reboot  
作用： 重启系统  

命令： poweroff  
作用： 关机并且切断电源  

命令： init 6  
作用： 重启  

命令： init 0  
作用： 关机  


______

## 查看硬件信息

命令： dmidecode  
作用： 列出所有硬件信息  

命令： dmidecode -t  
作用： 列出硬件类型  

命令： dmidecode -t 硬件类型  
作用： 根据硬件类型展示相应的硬件信息  


______


## 我是谁

命令： whoami  
作用： 显示当前操作用户的用户名  
`juntaran`  

命令： who am i  
作用： 显示登入系统用户的用户名，以及登录时间（只要有2个参数即可，无所谓是不是 am 和 i）  
`juntaran pts/0        2017-06-20 14:47 (192.168.126.1)`  

命令： who (-H)  
作用： 显示所有登入系统的用户的用户名，以及登录时间。-H 会加上列名  

| USER  | LINE  | TIME  | COMMENT  |
|---|---|---|---|
| juntaran  | pts/0  | 2017-06-20 14:47  | (192.168.126.1)  |
| juntaran  | tty/7  | 2017-06-16 20:12  | (:0)  |
| juntaran  | pts/1  | 2017-06-20 14:52  | (192.168.126.1)  |


命令： who -b  
作用： 显示系统上一次启动时间  
`system boot  2017-06-16 20:10`  

命令： w  
作用： `who`显示的是`show who is logged on`，`w`显示的是`show who is logged on and what they are doing`  

| USER  | TTY  | FROM  | LOGIN@  | IDLE  | JCPU  | PCPU  | WHAT  |
|---|---|---|---|---|---|---|---|
| juntaran  | pts/0  | 192.168.126.1  | 14:47  | 0.00s  | 0.17s  | 0.00s  | w  |
| juntaran  | tty/7  | :0  | Fri20  | 3days  | 57.27s  | 0.04s  | /bin/sh /usr/lib/gnome-session/run-systemd-session  |
| juntaran  | pts/1  | 192.168.126.1  | 14:52  | 44:28  | 0.03s  | 0.03s  | top  |

在运行`w`命令时，`pts/0`终端的`WHAT`显示了正在执行`w`，而另一个终端正在执行的`top`命令也被记录了  
另外，`JCPU`指的是与该tty终端连接的所由进程占用的时间，不包括过去的后台作业时间  
`PCPU`指的是当前进程（即w项中显示的）所占用的时间  

______


## 路由配置

命令： route -n  
作用： 显示路由表  

命令： route add default gw 192.168.1.2  
作用： 增加一条默认路由  

命令： route del gw 192.168.1.2  
作用： 删除一条默认路由  

______

## 链接

命令： ln -s a.txt b.txt
作用： 建立软链接（符号链接），同步更新，类似快捷方式

命令： ln a.txt b.txt
作用： 建立硬链接，不占用空间，不能给目录建立。可以认为一个文件拥有两个文件名

______


## 搜索

    find path -option [ -print ] [ -exec/-ok command ] {} \
    
path: find 命令所查找的目录路径。`.`来表示当前目录，用`/`来表示系统根目录   
`-print`： find 命令将匹配的文件输出到标准输出  
`-exec`： find 命令对匹配的文件执行该参数所给出的shell命令。将查到的文件执行command操作，`{}`和` \;`之间有空格  
`-ok`： 和`-exec`的作用相同，只不过以一种更为安全的模式来执行该参数所给出的shell命令，在执行每一个命令之前，都会给出提示，让用户来确定是否执行。

|   |   |
|---|---|
| -name filename  | 查找名为`filename`的文件  |
| -perm  | 按执行权限来查找  |
| -user username  | 按文件属主来查找  |
| -group groupname  | 按组来查找  |
| -mtime -n/+n  | 按文件更改时间来查找文件，`-n`指n天以内，`+n`指n天以前  |
| -atime -n/+n  | 按文件访问时间来查，`-n`指n天以内，`+n`指n天以前  |
| -ctime -n/+n  | 按文件创建时间来查找文件，`-n`指n天以内，`+n`指n天以前  |
| -amin  | 对应以上，天改为分钟  |
| -type b/d/c/p/l/f  | 查是块设备、目录、字符设备、管道、符号链接、普通文件  |
| -size n[c]  | 查长度为n块[或n字节]的文件  |
| -depth  | 设定搜索深度  |

命令： find . -name   "[A-Z]\*"   -print
作用： 当前目录下查找以大写字母开头的文件   

命令： find . -perm -007 -exec ls -l {} \;   
作用： 查所有用户都可读写执行的文件，并执行`ls -l`命令  

命令： grep -rl 'juntaran'  
作用： 递归搜索包含`juntaran`的文件  
`-r`表示递归，`-l`表示只输出文件名  

命令： grep -o 'juntaran' hexo/npm-debug.log  | wc -l  
作用： 搜索`hexo/npm-debug.log`文件内`juntaran`出现的次数  

命令： grep -o 'test\|juntaran' hexo/npm-debug.log  | wc -l  
作用： 搜索`hexo/npm-debug.log`文件内`juntaran`和`test`出现的总次数  

命令： find . -name "\*.c" | xargs grep -i 'juntaran'  
作用： 搜索当前目录下所有的包含`juntaran`的`.c`文件  

______

## 文件分割合并

命令： splite -l 1000 a.txt  
作用： 把 a.txt 按照每1000行进行拆分，拆分后为 xaa xab...  

命令： splite -b/-C 100m a.txt
作用： 把 a.txt 按照每100m进行切分，默认单位为字节，支持 k 和 m，-C 与 -b 类似，但是会尽量维持每行的完整性  

命令： splite -l 1000 a.txt -d -a 3 split_file  
作用： 把 a.txt 按照每1000行进行拆分，拆分后文件为 split_file000 split_file002 ...，`-d` 代表拆分后的文件使用数字后缀而不使用字母后缀，`-a 3`代表数字后缀的长度为3位，`split_file`只是自定义的拆分后文件名前缀  

命令： cat file1 file2 > file.txt  
作用： 合并 file1 file2 为 file.txt 文件  

______

## 系统性能

### 磁盘

命令： du -sh [目录/文件]  
作用： 显示指定的目录/文件大小，不填写则为当前目录  

命令： ls | xargs du -sh  
作用： 显示当前目录下所有文件大小  

命令： fdisk -l  
作用： 查看磁盘分区信息  

### CPU

#### top

命令： top  
技巧： `f`进入选择显示列和列的排序，也可以指定根据哪列进行排序展示 `R`根据当前排序逆序  `shift <>` 调整排序列  `P` 根据 CPU 进行排序  `M` 根据内存进行排序  `W`记录当前配置  `1`可以切换不同的核心   

#### mpstat

命令： mpstat  -P ALL 1
作用： 每隔`1秒`展示每一个 CPU 的运行状态，把`ALL`改成`0`就是显示第一个 CPU 的运行状态，`1`如果不写则只显示一次  

命令： mpstat -I ALL/CPU/SUM 1  
作用： 每隔`1秒`展示 整体/每一个CPU/ALL+CPU 的中断信息  

### 内存

命令： free -m  
作用： 以`mb`为单位显示内存信息  

### 进程

命令： ps -ef 与 ps aux  
作用： 显示进程信息  

命令： ps -ef | grep mysql  
作用： 显示 mysql 进程的信息，pid 为 10673  

命令： ps -L 10673  
作用： 显示 mysql 的线程信息  

命令： ps axjf 与 ps -ejH  
作用： 树形结构显示进程信息，展示子进程和父进程关系  

命令： pidof 进程名  
作用： 找到对应进程的进程号  

命令： pidof -x test.sh  
作用： 找到对应脚本的进程号  


### 性能分析常用工具

#### vmstat

命令： vmstat 1 4  
作用： 每隔1秒显示一次系统状态信息（进程个数与睡眠进程个数+内存+swap+块设备io+系统中断与上下文切换次数+CPU时间占比），共4次，其中第一次为开机以来的平均值  

| 参数  | 说明  |
|---|---|
| -f  | 显示开机以来的 fork 数  |
| -m  | 显示内存 slabinfo  |
| -s  | 显示内存指标以及系统事件信息  |
| -d  | 显示磁盘统计信息  |
| -p  | vmstat -p /dev/sda1 显示某一分区的 I/O 信息  |


#### iostat

命令： iostat  
作用： 显示系统信息 + CPU信息 + 磁盘信息  

命令： iostat -d -k -x -y 1 3  
作用： 每隔`1秒`显示磁盘信息以`KB`为单位，显示3次，去除第一次不准确信息。其中`-d`代表显示磁盘信息，`-k`代表以`KB`为单位，`-x`代表更详细输出，`-y`代表去除第一次不准确的信息  

命令： iostat -c -x -y 1 3  
作用：  每隔`1秒`显示 CPU 信息，显示3次，去除第一次不准确信息。其中`-c`代表显示 CPU 信息  


#### lsof 与 fuser

需要 root 权限  

命令： lsof 文件名  
作用： 根据文件名查找占用该文件的进程  

命令： fuser -v 文件名  
作用： 根据文件名查找占用该文件的进程  

命令： lsof -p PID  
作用： 根据进程号查找该进程打开的所有文件  

命令： ls -u username  
作用： 根据用户名查找该用户打开的所有文件  

命令： ls -i:端口号  
作用： 根据端口号查找占用该端口的进程  

命令： fuser -vn tcp 22  
作用： 根据端口号查找占用该端口的进程  

______

## 作业控制


在命令后添加`&`则会让作业在后台运行

    sleep 2000 &  
    
`Ctrl + Z`会让一个前台作业切换到后台，但是它会暂停

命令： jobs  
作用： 列出后台所有的作业，包括作业号、进程ID、占用的 CPU、当前状态和命令  

命令： bg %作业号  
作用： 让一个后台暂停的命令运行  

命令： fg %作业号  
作用： 把一个后台作业推到前台  

命令： kill %作业号  
作用： 杀掉指定的作业  


添加`&`虽然会让命令在后台运行，但是当终端断开或是用户注销等情况发生时，命令会自动终止，这时应该使用`nohup`  

命令： nohup 要执行的命令 > test.txt &  
作业： 后台执行命令，jobs 查询不到，会输出信息到`test.txt`，如果不设置输出会自动输出到`nohup.out`。该命令即使断开终端也会继续执行，可以通过`kill进程`的方式关闭该命令  

命令： sudo -b ./test.sh  
作用： 后台运行脚本，jobs 命令查询不到，终端断开也可以继续执行  
